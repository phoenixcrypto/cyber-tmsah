<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø£Ø¯Ø§Ø© ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</title>
<script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
<style>
* { box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0b0f14 0%, #1a1f2e 100%);
  color: #e6f1ff;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}
.container {
  max-width: 1400px;
  margin: 0 auto;
}
h1 {
  text-align: center;
  color: #00ffa2;
  margin-bottom: 30px;
  font-size: 28px;
}
.card {
  background: #0f1620;
  border: 1px solid #1f2a36;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
.section-title {
  color: #00ffa2;
  font-size: 18px;
  margin-bottom: 15px;
  border-bottom: 2px solid #1f2a36;
  padding-bottom: 8px;
}
.row {
  display: flex;
  gap: 15px;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 15px;
}
label {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #b8c5d6;
  font-size: 14px;
}
input[type="file"] {
  padding: 10px;
  background: #0b1320;
  border: 2px dashed #1f2a36;
  border-radius: 8px;
  color: #e6f1ff;
  cursor: pointer;
  font-size: 14px;
}
input[type="number"], input[type="text"], select {
  padding: 10px;
  background: #0b1320;
  border: 1px solid #1f2a36;
  border-radius: 6px;
  color: #e6f1ff;
  font-size: 14px;
  min-width: 120px;
}
input[type="number"] {
  width: 100px;
}
button {
  padding: 12px 24px;
  background: #00ffa2;
  color: #0b0f14;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}
button:hover:not(:disabled) {
  background: #00cc82;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,255,162,0.3);
}
button:disabled {
  background: #1f2a36;
  color: #6b7280;
  cursor: not-allowed;
}
.btn-secondary {
  background: #8b5cf6;
  color: white;
}
.btn-secondary:hover:not(:disabled) {
  background: #7c3aed;
}
.msg {
  padding: 12px;
  border-radius: 8px;
  margin-top: 15px;
  font-size: 14px;
}
.msg.success {
  background: rgba(0,255,162,0.1);
  border: 1px solid #00ffa2;
  color: #00ffa2;
}
.msg.warning {
  background: rgba(255,176,32,0.1);
  border: 1px solid #ffb020;
  color: #ffb020;
}
.msg.error {
  background: rgba(255,95,95,0.1);
  border: 1px solid #ff5f5f;
  color: #ff5f5f;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  background: #0b1320;
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  padding: 12px;
  text-align: right;
  border-bottom: 1px solid #1f2a36;
}
th {
  background: #0b1320;
  color: #00ffa2;
  font-weight: bold;
  position: sticky;
  top: 0;
}
tr:hover {
  background: #1a1f2e;
}
.preview-box {
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid #1f2a36;
  border-radius: 8px;
  padding: 10px;
  background: #0b1320;
}
.stats {
  display: flex;
  gap: 20px;
  margin-top: 15px;
  padding: 15px;
  background: #0b1320;
  border-radius: 8px;
}
.stat-item {
  flex: 1;
  text-align: center;
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #00ffa2;
}
.stat-label {
  font-size: 12px;
  color: #b8c5d6;
  margin-top: 5px;
}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ” Ø£Ø¯Ø§Ø© ØªÙ‚Ø³ÙŠÙ… Ø·Ù„Ø§Ø¨ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ</h1>

  <!-- Step 1: Upload File -->
  <div class="card">
    <div class="section-title">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</div>
    <div class="row">
      <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
      <button id="loadBtn" onclick="loadFile()">ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
    </div>
    <div id="fileMsg"></div>
  </div>

  <!-- Step 2: Configure -->
  <div class="card" id="configCard" style="display:none">
    <div class="section-title">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</div>
    <div class="row">
      <label>Ø§Ù„Ø´ÙŠØª: <select id="sheetSelect"></select></label>
      <label>Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§Ø³Ù…: <select id="nameColSelect"></select></label>
      <label>Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ®ØµØµ: <select id="specColSelect">
        <option value="">-- Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ± --</option>
      </select></label>
      <label>Ù‚ÙŠÙ…Ø© Ø§Ù„ÙÙ„ØªØ±: <input type="text" id="filterInput" value="Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ" placeholder="Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ"></label>
    </div>
    <div class="row">
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: <input type="number" id="expectedInput" value="703"></label>
      <label>Ø­Ø¬Ù… Group 1: <input type="number" id="g1Input" value="353"></label>
      <label style="gap:6px"><input type="checkbox" id="enforceBySection" checked> Ø±Ø¨Ø· Ø§Ù„Ø¬Ø±ÙˆØ¨ Ø¨Ø§Ù„Ø³ÙÙƒØ´Ù† (1-7 â‡¢ Group 1ØŒ 8-15 â‡¢ Group 2)</label>
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ø´Ù†: <input type="number" id="sectionsInput" value="15"></label>
      <button id="extractBtn" onclick="extractAndGenerate()" class="btn-secondary">âš¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªÙˆÙ„ÙŠØ¯</button>
    </div>
    <div id="configMsg"></div>
  </div>

  <!-- Step 3: Results -->
  <div class="card" id="resultsCard" style="display:none">
    <div class="section-title">Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
    <div class="stats" id="statsDiv"></div>
    <div class="row">
      <button id="downloadCsvBtn" onclick="downloadCSV()" disabled>ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ CSV</button>
      <button id="copyHtmlBtn" onclick="copyHTML()" disabled class="btn-secondary">ğŸ“‹ Ù†Ø³Ø® HTML</button>
    </div>
    <div class="preview-box">
      <div id="previewDiv"></div>
    </div>
  </div>
</div>

<script>
let workbook = null;
let currentSheet = null;
let extractedRows = [];

function showMsg(elementId, text, type = 'success') {
  const el = document.getElementById(elementId);
  el.innerHTML = `<div class="msg ${type}">${text}</div>`;
  setTimeout(() => el.innerHTML = '', 5000);
}

function loadFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];
  
  if (!file) {
    showMsg('fileMsg', 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'error');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = new Uint8Array(e.target.result);
      workbook = XLSX.read(data, { type: 'array' });
      
      // Fill sheet selector
      const sheetSelect = document.getElementById('sheetSelect');
      sheetSelect.innerHTML = '';
      workbook.SheetNames.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        sheetSelect.appendChild(opt);
      });
      
      // Load first sheet
      loadSheet(workbook.SheetNames[0]);
      
      document.getElementById('configCard').style.display = 'block';
      showMsg('fileMsg', 'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    } catch (error) {
      showMsg('fileMsg', 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ' + error.message, 'error');
      console.error(error);
    }
  };
  
  reader.readAsArrayBuffer(file);
}

function loadSheet(sheetName) {
  currentSheet = workbook.Sheets[sheetName];
  const jsonData = XLSX.utils.sheet_to_json(currentSheet, { header: 1, defval: '' });
  
  if (jsonData.length === 0) {
    showMsg('configMsg', 'âš ï¸ Ø§Ù„Ø´ÙŠØª ÙØ§Ø±Øº', 'warning');
    return;
  }
  
  const header = jsonData[0] || [];
  
  // Fill column selectors
  const nameColSelect = document.getElementById('nameColSelect');
  const specColSelect = document.getElementById('specColSelect');
  
  nameColSelect.innerHTML = '';
  specColSelect.innerHTML = '<option value="">-- Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ± --</option>';
  
  header.forEach((col, idx) => {
    const nameOpt = document.createElement('option');
    nameOpt.value = idx;
    nameOpt.textContent = col || `Ø¹Ù…ÙˆØ¯ ${idx + 1}`;
    nameColSelect.appendChild(nameOpt);
    
    const specOpt = document.createElement('option');
    specOpt.value = idx;
    specOpt.textContent = col || `Ø¹Ù…ÙˆØ¯ ${idx + 1}`;
    specColSelect.appendChild(specOpt);
  });
  
  // Auto-detect columns
  const nameKeywords = ['Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ø³Ù…', 'name', 'student'];
  const specKeywords = ['Ø§Ù„ØªØ®ØµØµ', 'Ø§Ù„Ù‚Ø³Ù…', 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬', 'specialization', 'department'];
  
  header.forEach((col, idx) => {
    const colLower = String(col).toLowerCase();
    if (nameKeywords.some(k => colLower.includes(k.toLowerCase()))) {
      nameColSelect.value = idx;
    }
    if (specKeywords.some(k => colLower.includes(k.toLowerCase()))) {
      specColSelect.value = idx;
    }
  });
}

document.getElementById('sheetSelect').onchange = function() {
  loadSheet(this.value);
};

function extractAndGenerate() {
  if (!workbook || !currentSheet) {
    showMsg('configMsg', 'âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'error');
    return;
  }
  
  const sheetName = document.getElementById('sheetSelect').value;
  const nameColIdx = parseInt(document.getElementById('nameColSelect').value);
  const specColIdx = document.getElementById('specColSelect').value ? parseInt(document.getElementById('specColSelect').value) : null;
  const filterValue = document.getElementById('filterInput').value.trim().toLowerCase();
  const expected = parseInt(document.getElementById('expectedInput').value) || 0;
  const g1Size = parseInt(document.getElementById('g1Input').value) || 353;
  const sections = parseInt(document.getElementById('sectionsInput').value) || 15;
  const enforceBySection = document.getElementById('enforceBySection').checked;
  
  if (isNaN(nameColIdx)) {
    showMsg('configMsg', 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§Ø³Ù…', 'error');
    return;
  }
  
  const jsonData = XLSX.utils.sheet_to_json(currentSheet, { header: 1, defval: '' });
  const rows = jsonData.slice(1); // Skip header
  
  // Extract names
  let names = rows
    .map(row => String(row[nameColIdx] || '').trim())
    .filter(name => name.length > 0);
  
  // Apply filter if specified
  if (specColIdx !== null && filterValue) {
    names = rows
      .filter(row => {
        const spec = String(row[specColIdx] || '').toLowerCase();
        return spec.includes(filterValue);
      })
      .map(row => String(row[nameColIdx] || '').trim())
      .filter(name => name.length > 0);
  }
  
  if (names.length === 0) {
    showMsg('configMsg', 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„ÙÙ„ØªØ±Ø©', 'error');
    document.getElementById('resultsCard').style.display = 'none';
    return;
  }
  
  // Generate sections (sequential blocks) then groups
  // Ø§Ù„ØªÙˆØ²ÙŠØ¹: Ø£ÙˆÙ„ 14 Ø³ÙƒØ´Ù† = 47 Ø·Ø§Ù„Ø¨ Ù„ÙƒÙ„ Ø³ÙƒØ´Ù†ØŒ Ø³ÙƒØ´Ù† 15 = Ø§Ù„Ø¨Ø§Ù‚ÙŠ (45)
  // Ù…Ø«Ø§Ù„: 703 Ø·Ø§Ù„Ø¨ â†’ Ø³ÙƒØ§Ø´Ù† 1-14 (47 Ù„ÙƒÙ„) = 658ØŒ Ø³ÙƒØ´Ù† 15 = 45
  const total = names.length;
  const studentsPerSection = 47;
  const lastSectionCapacity = total - (studentsPerSection * (sections - 1));
  
  // Ø¨Ù†Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø³Ø¹Ø§Øª: Ø£ÙˆÙ„ 14 Ø³ÙƒØ´Ù† = 47ØŒ Ø³ÙƒØ´Ù† 15 = Ø§Ù„Ø¨Ø§Ù‚ÙŠ
  const capacities = Array.from({ length: sections }, (_, i) => 
    i < sections - 1 ? studentsPerSection : lastSectionCapacity
  );

  extractedRows = [];
  let secIndex = 0; // 0-based section index (0 = Ø³ÙƒØ´Ù† 1ØŒ 14 = Ø³ÙƒØ´Ù† 15)
  let filledInCurrent = 0; // Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù…Ù„ÙˆØ¡ÙŠÙ† ÙÙŠ Ø§Ù„Ø³ÙƒØ´Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ
  
  // Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ù† Ø§Ù„ÙƒØ´Ù (sequential blocks)
  // Ø§Ù„Ø·Ù„Ø§Ø¨ 1-47 â†’ Ø³ÙƒØ´Ù† 1ØŒ 48-94 â†’ Ø³ÙƒØ´Ù† 2ØŒ ...ØŒ 659-703 â†’ Ø³ÙƒØ´Ù† 15
  for (let i = 0; i < names.length; i++) {
    const sectionNumber = secIndex + 1; // Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒØ´Ù† (1-15)
    const groupValue = enforceBySection
      ? (sectionNumber <= 7 ? 'Group 1' : 'Group 2')
      : (i < g1Size ? 'Group 1' : 'Group 2');
    
    extractedRows.push({
      'Full Name': names[i],
      'Section Number': sectionNumber,
      'Group': groupValue,
      'Student ID': i + 1
    });

    filledInCurrent++;
    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³ÙƒØ´Ù† Ø§Ù„ØªØ§Ù„ÙŠ Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    // Ù…Ø«Ø§Ù„: Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨ 47 ÙÙŠ Ø³ÙƒØ´Ù† 1 â†’ filledInCurrent = 47 â†’ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø³ÙƒØ´Ù† 2
    if (filledInCurrent >= capacities[secIndex] && secIndex < sections - 1) {
      secIndex++;
      filledInCurrent = 0;
    }
  }
  
  // Show stats
  const g1Count = extractedRows.filter(r => r.Group === 'Group 1').length;
  const g2Count = extractedRows.length - g1Count;
  const sectionCounts = {};
  extractedRows.forEach(r => {
    sectionCounts[r['Section Number']] = (sectionCounts[r['Section Number']] || 0) + 1;
  });
  
  let statsHTML = `
    <div class="stat-item">
      <div class="stat-value">${extractedRows.length}</div>
      <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
    </div>
    <div class="stat-item">
      <div class="stat-value">${g1Count}</div>
      <div class="stat-label">Group 1</div>
    </div>
    <div class="stat-item">
      <div class="stat-value">${g2Count}</div>
      <div class="stat-label">Group 2</div>
    </div>
  `;

  if (enforceBySection) {
    const expectedG1 = capacities.slice(0, 7).reduce((a,b)=>a+b,0);
    statsHTML += `
      <div class=\"stat-item\">
        <div class=\"stat-value\">${expectedG1}</div>
        <div class=\"stat-label\">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø³ÙƒØ§Ø´Ù† 1-7)</div>
      </div>
    `;
  }
  
  if (expected && extractedRows.length !== expected) {
    statsHTML += `
      <div class="stat-item">
        <div class="stat-value" style="color:#ffb020">${expected}</div>
        <div class="stat-label">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
      </div>
    `;
  }
  
  document.getElementById('statsDiv').innerHTML = statsHTML;
  
  // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„ÙƒÙ„ Ø³ÙƒØ´Ù† Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ²ÙŠØ¹
  let sectionDetailsHTML = '<div style="margin-top:20px;padding:15px;background:#0b1320;border-radius:8px;border:1px solid #1f2a36;"><h4 style="color:#00ffa2;margin-bottom:10px">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù„ÙƒÙ„ Ø³ÙƒØ´Ù†:</h4><table style="width:100%;font-size:12px"><thead><tr><th style="padding:8px;text-align:center">Ø§Ù„Ø³ÙƒØ´Ù†</th><th style="padding:8px;text-align:center">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th><th style="padding:8px;text-align:center">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th><th style="padding:8px;text-align:center">Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
  for (let s = 1; s <= sections; s++) {
    const actual = sectionCounts[s] || 0;
    const expected = capacities[s - 1];
    const status = actual === expected ? 'âœ…' : 'âš ï¸';
    const statusColor = actual === expected ? '#00ffa2' : '#ffb020';
    sectionDetailsHTML += `<tr><td style="padding:8px;text-align:center">Ø³ÙƒØ´Ù† ${s}</td><td style="padding:8px;text-align:center">${actual}</td><td style="padding:8px;text-align:center">${expected}</td><td style="padding:8px;text-align:center;color:${statusColor}">${status}</td></tr>`;
  }
  sectionDetailsHTML += '</tbody></table></div>';
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  document.getElementById('statsDiv').innerHTML += sectionDetailsHTML;
  
  // Show preview
  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Section Number</th>
          <th>Group</th>
          <th>Student ID</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  extractedRows.forEach(row => {
    tableHTML += `
      <tr>
        <td>${row['Full Name']}</td>
        <td>${row['Section Number']}</td>
        <td>${row['Group']}</td>
        <td>${row['Student ID']}</td>
      </tr>
    `;
  });
  
  tableHTML += '</tbody></table>';
  document.getElementById('previewDiv').innerHTML = tableHTML;
  
  // Enable buttons
  document.getElementById('downloadCsvBtn').disabled = false;
  document.getElementById('copyHtmlBtn').disabled = false;
  document.getElementById('resultsCard').style.display = 'block';
  
  // Show message
  let msg = `âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${extractedRows.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!`;
  if (expected && extractedRows.length !== expected) {
    msg += ` (Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${expected})`;
  }
  showMsg('configMsg', msg, extractedRows.length === expected ? 'success' : 'warning');
}

function downloadCSV() {
  if (extractedRows.length === 0) return;
  
  const headers = ['Full Name', 'Section Number', 'Group', 'Student ID'];
  const csvContent = [
    headers.join(','),
    ...extractedRows.map(row => 
      headers.map(h => `"${String(row[h]).replace(/"/g, '""')}"`).join(',')
    )
  ].join('\n');
  
  const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'students_split.csv';
  link.click();
}

function copyHTML() {
  if (extractedRows.length === 0) return;
  
  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Section Number</th>
          <th>Group</th>
          <th>Student ID</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  extractedRows.forEach(row => {
    tableHTML += `
      <tr>
        <td>${row['Full Name']}</td>
        <td>${row['Section Number']}</td>
        <td>${row['Group']}</td>
        <td>${row['Student ID']}</td>
      </tr>
    `;
  });
  
  tableHTML += '</tbody></table>';
  
  navigator.clipboard.writeText(tableHTML).then(() => {
    alert('âœ… ØªÙ… Ù†Ø³Ø® Ø¬Ø¯ÙˆÙ„ HTML Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
  }).catch(() => {
    alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®. ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.');
  });
}
</script>
</body>
</html>
